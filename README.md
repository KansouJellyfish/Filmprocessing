# Filmprocessing
本简(jian)易(lou)脚本使用 matlab 编写，旨在快速、（较为）准确、批量化地为彩色负片去除色罩。脚本可能存在一些问题，包括原理上或代码上，欢迎批评指正！
# 工作流程
## 前期准备
### 胶卷拍摄
- 使用胶卷拍摄正常曝光下的 18% 灰卡（以柯达 5207 为例，其特性曲线在 5500 K下测得，则需要使用该胶卷拍摄一张 5500 K 下正常曝光的灰卡，例如正午太阳底下），作为参考点
- 胶卷拍摄完成后，拉出片头，使片头完全过曝，作为胶卷的黑场
### 翻拍
- 在正确的翻拍条件（稳定光源、校准白平衡、调整曝光度至合适值等）的情况下，使用相机拍摄胶片，并以 RAW 格式记录
- 拍摄所有胶卷，包括黑场、参考点，以及没有曝光过的片基部分
### 去色罩前准备
- 所有翻拍照片的 RAW 文件
- 相机所拍摄画面的黑点、白点图片，与图片黑点意味着没有光线时的图片，白点意味着相机拍摄光源的图片
- 胶卷的黑点、白点图片，黑点即片基没有曝光部分，白点即片头过曝部分
- 安装软件 DCraw
- 数字化后的胶卷的特性曲线
## 将图像线性化
使用脚本 tiffconvert.m，通过调用 DCraw 将翻拍图像线性化，以 tiff 储存在图片的目录
## 读取线性化图像，并计算通光率 T
根据相机拍摄画面的黑点、白点图片，计算出胶片各处的通光率 T
## 根据通光率 T，计算吸收率 A
基于比尔-朗伯定律，将通光率 T 转换为吸收率 A：
$$A=-\log _{10}{\frac {1}{T}}$$
## 计算吸收率 A 与密度 D 对应关系，并得到密度 D
同样根据比尔-朗伯定律可知，吸收率 A 与密度 D（即胶卷特性曲线中的纵坐标值）为等比例对应的关系，因此根据先前的正常曝光底片，可计算得到 D/A 的值，记为 k，根据 k 得到所有底片的密度 D
## 查找特性曲线，通过 D 得到曝光度 H
各个胶卷的特性曲线可以在网上查到，通过图片数字化工具（例如 GetData）可以将其数字化，这里放了部分胶卷的特性曲线，例如 5207、fuji 400 等
## 归一化并输出
以胶卷的黑点、白点值的曝光度 H，对所有图像归一化，并输出，此时去色罩就完成了，后续可以在通过使用 LUT 等方式，进一步对图像进行调整，或是简单拉一下对比度曲线也可

